
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../l4gateway/">
      
      
        <link rel="next" href="../customization/">
      
      
      <link rel="icon" href="../../../assets/images/aws_load_balancer_icon.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>L7 Routing - AWS Load Balancer Controller</title>
      
    
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    <link rel="stylesheet" href="../../../assets/stylesheets/version-select.css">

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gateway-api-for-layer-7-alb-implementation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">
    <nav
      class="md-header__inner md-grid"
      aria-label="header.title"
    >
  
      <!-- Link to home -->
      <a
        href="../../.."
        title="AWS Load Balancer Controller"
        class="md-header__button md-logo"
        aria-label="AWS Load Balancer Controller"
        data-md-component="logo"
      >
        
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

      </a>
  
      <!-- Button to open drawer -->
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
      </label>
  
      <!-- Header title -->
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              AWS Load Balancer Controller
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                L7 Routing
              
            </span>
          </div>
        </div>
      </div>
  
      <!-- Color palette -->
      

      <div id="version-select" class="mdc-select" data-base-url="../../..">
    <div class="mdc-select__anchor" role="button">
        <span class="mdc-select__ripple"></span>
        <span class="mdc-select__selected-text-container">
            <span class="mdc-select__selected-text"></span>
        </span>
        <span class="mdc-select__dropdown-icon">
            <svg class="mdc-select__dropdown-icon-graphic" viewBox="7 10 10 5" focusable="false">
                <polygon class="mdc-select__dropdown-icon-inactive" stroke="none" fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon class="mdc-select__dropdown-icon-active" stroke="none" fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
            </svg>
        </span>
    </div>

    <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
        <ul class="mdc-list" role="listbox">
        </ul>
    </div>
</div>
      <!-- Site language selector -->
      
  
      <!-- Button to open search modal -->
      
  
      <!-- Repository information -->
      
        <div class="md-header__source">
          <a href="https://github.com/kubernetes-sigs/aws-load-balancer-controller" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubernetes-sigs/aws-load-balancer-controller
  </div>
</a>
        </div>
      
    </nav>
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../deploy/installation/" class="md-tabs__link">
          
  
  Deployment

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../ingress/annotations/" class="md-tabs__link">
          
  
  Guide

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/echo_server/" class="md-tabs__link">
          
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AWS Load Balancer Controller" class="md-nav__button md-logo" aria-label="AWS Load Balancer Controller" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AWS Load Balancer Controller
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kubernetes-sigs/aws-load-balancer-controller" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubernetes-sigs/aws-load-balancer-controller
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Home
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how-it-works/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How it works
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/configurations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configurations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/subnet_discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subnet Discovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/security_groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Group Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/pod_readiness_gate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod Readiness Gate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/scaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling your LBC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Upgrade
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Upgrade
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deploy/upgrade/migrate_v1_v2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrate v1 to v2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingress
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Ingress
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/ingress_class/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IngressClass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/cert_discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certificate Discovery
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Service
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Service
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service/nlb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Load Balancer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service/annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TargetGroupBinding
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            TargetGroupBinding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../targetgroupbinding/targetgroupbinding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TargetGroupBinding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../targetgroupbinding/spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gateway API (New)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Gateway API (New)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../l4gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L4 Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    L7 Routing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    L7 Routing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gateway-api-resources-and-controller-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway API Resources and Controller Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-reconciliation-loop" class="md-nav__link">
    <span class="md-ellipsis">
      The Reconciliation Loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-l7-gateway-api-resource-implementation-with-an-example" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step L7 Gateway API Resource Implementation with an Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step L7 Gateway API Resource Implementation with an Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-comparison-alb-gateways-vs-standard-gateway-api" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Comparison: ALB Gateways vs. Standard Gateway API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Comparison: ALB Gateways vs. Standard Gateway API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayclass" class="md-nav__link">
    <span class="md-ellipsis">
      GatewayClass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listener" class="md-nav__link">
    <span class="md-ellipsis">
      Listener
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpcroute" class="md-nav__link">
    <span class="md-ellipsis">
      GRPCRoute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httproute" class="md-nav__link">
    <span class="md-ellipsis">
      HTTPRoute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-tls-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Backend TLS Policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestredirect-path-modification-replaceprefixmatch-limitation" class="md-nav__link">
    <span class="md-ellipsis">
      RequestRedirect Path Modification ReplacePrefixMatch Limitation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-request-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying Request Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-header-matching" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Header Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-ip-condition" class="md-nav__link">
    <span class="md-ellipsis">
      Source IP Condition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_4" id="__nav_3_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Customizations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_4">
            <span class="md-nav__icon md-icon"></span>
            Customizations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How customizations works
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../loadbalancerconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LoadBalancerConfiguration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../targetgroupconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TargetGroupConfiguration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../listenerruleconfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ListenerRuleConfiguration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway_chaining/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway Chaining
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AWS Global Accelerator (New)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            AWS Global Accelerator (New)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../globalaccelerator/aga-controller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../globalaccelerator/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../globalaccelerator/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../globalaccelerator/spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/cognito_authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cognito Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/ssl_redirect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSL Redirect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/url_rewrite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL Rewrite
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Use Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/nlb_tls_termination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLB TLS Termination
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/self_managed_lb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Externally Managed Load Balancer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/frontend_sg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frontend Security Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/blue_green/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blue/Green
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/multi_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MultiCluster Target Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/quic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QUIC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use_cases/legacy_app_integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Legacy Target Groups
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metrics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Metrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/prometheus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ALB Target Optimizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            ALB Target Optimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/alb-target-agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Target Control Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingress/alb-target-agent-spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ALBTargetControlConfig
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/echo_server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EchoServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/grpc_server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gRPCServer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/external_dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup External DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/secrets_access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RBAC to access OIDC Secret
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gateway-api-resources-and-controller-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway API Resources and Controller Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-reconciliation-loop" class="md-nav__link">
    <span class="md-ellipsis">
      The Reconciliation Loop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-l7-gateway-api-resource-implementation-with-an-example" class="md-nav__link">
    <span class="md-ellipsis">
      Step-by-Step L7 Gateway API Resource Implementation with an Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step L7 Gateway API Resource Implementation with an Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-comparison-alb-gateways-vs-standard-gateway-api" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Comparison: ALB Gateways vs. Standard Gateway API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Comparison: ALB Gateways vs. Standard Gateway API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gatewayclass" class="md-nav__link">
    <span class="md-ellipsis">
      GatewayClass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Gateway
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listener" class="md-nav__link">
    <span class="md-ellipsis">
      Listener
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpcroute" class="md-nav__link">
    <span class="md-ellipsis">
      GRPCRoute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httproute" class="md-nav__link">
    <span class="md-ellipsis">
      HTTPRoute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-tls-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Backend TLS Policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestredirect-path-modification-replaceprefixmatch-limitation" class="md-nav__link">
    <span class="md-ellipsis">
      RequestRedirect Path Modification ReplacePrefixMatch Limitation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-request-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying Request Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-header-matching" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Header Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-ip-condition" class="md-nav__link">
    <span class="md-ellipsis">
      Source IP Condition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="gateway-api-for-layer-7-alb-implementation">Gateway API for Layer 7 (ALB) Implementation<a class="headerlink" href="#gateway-api-for-layer-7-alb-implementation" title="Permanent link">&para;</a></h1>
<p>This section details the <strong>AWS Load Balancer Controller's (LBC)</strong> architecture and operational flow when processing Gateway API resources for Layer 7 traffic utilizing an AWS ALB.</p>
<h3 id="gateway-api-resources-and-controller-architecture">Gateway API Resources and Controller Architecture<a class="headerlink" href="#gateway-api-resources-and-controller-architecture" title="Permanent link">&para;</a></h3>
<p>The LBC implements Gateway API support through a dual architecture, using distinct controller instances for <strong>Layer 4 (L4)</strong> and <strong>Layer 7 (L7)</strong> routing. This design allows for specialized and optimized reconciliation aligned with the underlying AWS Load Balancer capabilities.</p>
<p>The LBC instance dedicated to L7 routing monitors the following Gateway API resources:</p>
<ul>
<li><strong><code>GatewayClass</code></strong>: For L7 routing, the LBC specifically manages <code>GatewayClass</code> resources with the <code>controllerName</code> set to <code>gateway.k8s.aws/alb</code>.</li>
<li><strong><code>Gateway</code></strong>: For every gateway that references a <code>GatewayClass</code> with the <code>controllerName</code> set to <code>gateway.k8s.aws/alb</code>, the LBC provisions an AWS ALB.</li>
<li><strong><code>HTTPRoute</code></strong>: Defines HTTP-specific routing rules, enabling HTTP communication between the load balancer and backend targets. These routes are handled by an <strong>AWS ALB</strong>.</li>
<li><strong><code>GRPCRoute</code></strong>: Defines GRPC-specific routing rules, enabling GRPC communication between the load balancer and backend targets. These routes are handled by an <strong>AWS ALB</strong>.</li>
<li><strong><code>ReferenceGrant</code></strong>: Defines cross-namespace access. For more information, <a href="https://gateway-api.sigs.k8s.io/api-types/referencegrant/">see</a></li>
<li><strong><code>LoadBalancerConfiguration</code> (LBC CRD)</strong>: A Custom Resource Definition utilized for fine-grained customization of the provisioned ALB. This CRD can be attached to a <code>Gateway</code> or its <code>GatewayClass</code>. For more information, please refer to  <a href="../customization/#customizing-the-gateway-load-balancer-using-loadbalancerconfiguration-crd">How customization works</a>.</li>
<li><strong><code>TargetGroupConfiguration</code> (LBC CRD)</strong>: A Custom Resource Definition used for service-specific customizations of AWS Target Groups. This CRD is associated with a Kubernetes <code>Service</code>. For more information, please refer to <a href="../customization/#customizing-services-target-groups-using-targetgroupconfiguration-crd">How customization works</a>.</li>
<li><strong><code>ListenerRuleConfiguration</code> (LBC CRD)</strong>: A Custom Resource Definition used for rule-specific customizations of AWS Listener Rules. This CRD is associated with one or more <code>HTTPRoute</code> or <code>GRPCRoute</code> to provide functionality supported by AWS ALB, but not natively available within the Gateway API. For more information, please refer to <a href="../customization/#customizing-l7-routing-rules">Advanced Configuration</a>.</li>
</ul>
<h3 id="the-reconciliation-loop">The Reconciliation Loop<a class="headerlink" href="#the-reconciliation-loop" title="Permanent link">&para;</a></h3>
<p>The LBC operates on a continuous <strong>reconciliation loop</strong> within your cluster to maintain the desired state of AWS Load Balancer resources:</p>
<ol>
<li><strong>Event Watching:</strong> The L7-specific controller instance constantly monitors the Kubernetes API for changes to the resources mentioned above related to ALB provisioning.</li>
<li><strong>Queueing:</strong> Upon detecting any modification, creation, or deletion of these resources, the respective object is added to an internal processing queue.</li>
<li><strong>Processing:</strong><ul>
<li>The controller retrieves the resource from the queue.</li>
<li>It validates the resource's configuration and determines if it falls under its management (e.g., by checking the <code>GatewayClass</code>'s <code>controllerName</code>). If it does, it enqueues the relevant gateway for processing.</li>
<li>The Kubernetes Gateway API definitions are then translated into an equivalent desired state within AWS (e.g., specific ALB, Listeners, Listener Rules, Target Groups, Addons, etc).</li>
<li>This desired state is compared against the actual state of AWS resources.</li>
<li>Necessary AWS API calls are executed to reconcile any identified discrepancies, ensuring the cloud infrastructure matches the Kubernetes declaration.</li>
</ul>
</li>
<li><strong>Status Updates:</strong> After reconciliation, the LBC updates the <code>status</code> field of the Gateway API resources in Kubernetes. This provides real-time feedback on the provisioned AWS resources, such as the ALB's DNS name and ARN, and whether the gateways are accepted.</li>
</ol>
<h3 id="step-by-step-l7-gateway-api-resource-implementation-with-an-example">Step-by-Step L7 Gateway API Resource Implementation with an Example<a class="headerlink" href="#step-by-step-l7-gateway-api-resource-implementation-with-an-example" title="Permanent link">&para;</a></h3>
<p>This section illustrates the step-by-step process of configuring the Gateway API resources, demonstrating provisioning and configuration for an ALB.</p>
<p>Consider a scenario where an application exposes an HTTP and HTTPS endpoint.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># alb-gatewayclass.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GatewayClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-alb-gateway-class</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">controllerName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws/alb</span>
<span class="nn">---</span>
<span class="c1"># my-alb-gateway.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-alb-gateway</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-alb-gateway-class</span>
<span class="w">  </span><span class="nt">infrastructure</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parametersRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancerConfiguration</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-gw-lbconfig-1</span>
<span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws</span>
<span class="w">  </span><span class="nt">listeners</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Same</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">    </span><span class="nt">allowedRoutes</span><span class="p">:</span>
<span class="w">      </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Same</span>
<span class="nn">---</span>
<span class="c1"># lbconfig.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancerConfiguration</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-gw-lbconfig-1</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">listenerConfigurations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocolPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS:443</span>
<span class="w">      </span><span class="nt">defaultCertificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;my cert arn&gt;</span>
<span class="nn">---</span>
<span class="c1"># httproute.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-app-route</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-alb-gateway</span>
<span class="w">    </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-alb-gateway</span>
<span class="w">    </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your service&gt;</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your service port&gt;</span>
</code></pre></div>
<ul>
<li><strong>API Event Detection:</strong> The LBC's L7 controller continuously monitors the Kubernetes API server. Upon detecting the <code>aws-alb-gateway-class</code> (with <code>controllerName: gateway.k8s.aws/alb</code>), the <code>my-alb-gateway</code> (referencing this <code>GatewayClass</code>), and <code>my-http-app-route</code> (referencing <code>my-alb-gateway</code>'s listener) resources, it recognizes its responsibility to manage these objects and initiates the provisioning of AWS resources.</li>
<li><strong>ALB Provisioning:</strong> An <strong>AWS Application Load Balancer (ALB)</strong> is provisioned in AWS for the <code>my-alb-gateway</code> resource with default settings. At this stage, the ALB is active but does not yet have any configured listeners. As soon as the ALB becomes active, the status of the gateway is updated.</li>
<li><strong>L7 Listener Materialization:</strong> The controller processes the <code>my-http-app-route</code> resource. Given that the <code>HTTPRoute</code> validly references the <code>my-alb-gateway</code> and its <code>http</code> and <code>https</code> listeners, two <strong>Listeners</strong> are materialized on the ALB. The listeners accept HTTP traffic on port 80 and HTTPS traffic on port 443 and forward them to the service hosted on the HTTPRoute.</li>
<li><strong>Target Group Creation:</strong> An <strong>AWS Target Group</strong> is created that contains the cluster nodes with the configured NodePort of the service.</li>
</ul>
<h4 id="feature-comparison-alb-gateways-vs-standard-gateway-api">Feature Comparison: ALB Gateways vs. Standard Gateway API<a class="headerlink" href="#feature-comparison-alb-gateways-vs-standard-gateway-api" title="Permanent link">&para;</a></h4>
<p>The AWS ALB Gateway implementation does not fully implement all Core functionality as mandated by the Gateway API. This is due
to feature limitations of AWS ALB, this table should be helpful in navigating the features available within the ALB Gateway. For more
information see the <a href="https://gateway-api.sigs.k8s.io/concepts/conformance/">Gateway API Conformance Page</a></p>
<h5 id="gatewayclass">GatewayClass<a class="headerlink" href="#gatewayclass" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Conformance Level</th>
<th style="text-align: right;">ALB Gateway Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ControllerName</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">ParametersRef</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Description</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Status</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<h5 id="gateway">Gateway<a class="headerlink" href="#gateway" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Conformance Level</th>
<th style="text-align: right;">ALB Gateway Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Listeners</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Addresses</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Infrastructure</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Used to attach LB Config</td>
</tr>
<tr>
<td style="text-align: left;">Status</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Find the ALB ARN here</td>
</tr>
<tr>
<td style="text-align: left;">AllowedListeners</td>
<td style="text-align: left;">Experimental</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GatewayTLSConfig</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GatewayDefaultScope</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<h5 id="listener">Listener<a class="headerlink" href="#listener" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Conformance Level</th>
<th style="text-align: right;">ALB Gateway Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Protocol Specification</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Port Specification</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Section Specification</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Hostname Specification</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Allowed Routes Specification</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">ListenerTLSConfig - TLSModeType</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">ListenerTLSConfig - CertificateRefs</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Use LB Config</td>
</tr>
<tr>
<td style="text-align: left;">ListenerTLSConfig - Options</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Use LB Config</td>
</tr>
</tbody>
</table>
<h5 id="grpcroute">GRPCRoute<a class="headerlink" href="#grpcroute" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Conformance Level</th>
<th style="text-align: right;">ALB Gateway Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ParentRefs</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">UseDefaultGateways</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Hostnames</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - Section Name</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteMatch - GRPCMethodMatch</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteMatch - GRPCHeaderMatch</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteFilter - Type</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;">-- Partial support</td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteFilter - RequestHeaderModifier</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;">-- <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/header-modification.html">Limited Support</a></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteFilter - ResponseHeaderModifier</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteFilter - RequestMirror</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - GRPCRouteFilter - ExtensionRef</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;">-- Use to attach <a href="../customization/#customizing-l7-routing-rules">ListenerRuleConfigurations</a></td>
</tr>
<tr>
<td style="text-align: left;">GRPCRouteRule - SessionPersistence</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"> -- Use ListenerRuleConfiguration</td>
</tr>
</tbody>
</table>
<h5 id="httproute">HTTPRoute<a class="headerlink" href="#httproute" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Conformance Level</th>
<th style="text-align: right;">ALB Gateway Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ParentRefs</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">UseDefaultGateways</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">Hostnames</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - Section Name</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteMatch - HTTPPathMatch</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteMatch - HTTPHeaderMatch</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteMatch - HTTPQueryParamMatch</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteMatch - HTTPMethod</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - Type</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Partial support</td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - RequestHeaderModifier</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;">-- <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/header-modification.html">Limited Support</a></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - ResponseHeaderModifier</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - RequestMirror</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - RequestRedirect</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- See <a href="#requestredirect-path-modification-replaceprefixmatch-limitation">ReplacePrefixMatch Limitation</a> below</td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - UrlRewrite</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - CORS</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - ExternalAuth</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"> -- Use <a href="../customization/#customizing-l7-routing-rules">ListenerRuleConfigurations</a></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteFilter - ExtensionRef</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"> -- Use to attach <a href="../customization/#customizing-l7-routing-rules">ListenerRuleConfigurations</a></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPBackendRef</td>
<td style="text-align: left;">Core</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteTimeouts</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - HTTPRouteRetry</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"></td>
</tr>
<tr>
<td style="text-align: left;">HTTPRouteRule - SessionPersistence</td>
<td style="text-align: left;">Extended</td>
<td style="text-align: right;"> -- Use ListenerRuleConfiguration</td>
</tr>
</tbody>
</table>
<h5 id="backend-tls-policy">Backend TLS Policy<a class="headerlink" href="#backend-tls-policy" title="Permanent link">&para;</a></h5>
<p>Backend TLS is not supported by AWS ALB Gateway. For more information on how AWS ALB communicates with targets using encryption, 
please see the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-target-groups.html#target-group-routing-configuration">AWS documentation</a>.</p>
<h5 id="requestredirect-path-modification-replaceprefixmatch-limitation">RequestRedirect Path Modification ReplacePrefixMatch Limitation<a class="headerlink" href="#requestredirect-path-modification-replaceprefixmatch-limitation" title="Permanent link">&para;</a></h5>
<p>The AWS Load Balancer Controller supports HTTPRoute RequestRedirect filters with both <code>ReplaceFullPath</code> and <code>ReplacePrefixMatch</code> path modification types.</p>
<p><strong>ReplacePrefixMatch Behavior:</strong></p>
<p>We support <code>ReplacePrefixMatch</code> with limitations:</p>
<ol>
<li><strong>With scheme/port/hostname changes</strong> - Works as expected:
   <div class="highlight"><pre><span></span><code><span class="nt">filters</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RequestRedirect</span>
<span class="w">  </span><span class="nt">requestRedirect</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span><span class="w">  </span><span class="c1"># or port/hostname</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplacePrefixMatch</span>
<span class="w">      </span><span class="nt">replacePrefixMatch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/new-prefix</span>
</code></pre></div></li>
<li>Request: <code>/old-prefix/path/to/resource</code></li>
<li>
<p>Redirects to: <code>/new-prefix/path/to/resource</code>  (suffix preserved)</p>
</li>
<li>
<p><strong>Without other component changes</strong> - AWS ALB will reject with redirect loop error:
   <div class="highlight"><pre><span></span><code><span class="nt">filters</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RequestRedirect</span>
<span class="w">  </span><span class="nt">requestRedirect</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplacePrefixMatch</span>
<span class="w">      </span><span class="nt">replacePrefixMatch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/new-prefix</span>
</code></pre></div></p>
</li>
<li>This configuration will be rejected by the API with "InvalidLoadBalancerAction: The redirect configuration is not valid because it creates a loop." </li>
</ol>
<p><strong>Recommendations:</strong></p>
<ul>
<li>For path-only redirects, use <code>ReplaceFullPath</code> instead</li>
<li>To use <code>ReplacePrefixMatch</code>, you must also modify <code>scheme</code>, <code>port</code>, or <code>hostname</code></li>
</ul>
<p><strong>Important</strong>: If one HTTPRoute rule has an invalid redirect configuration (e.g., path-only redirect with <code>ReplacePrefixMatch</code> that cause redirect loop), the controller will fail to create that listener rule and stop processing subsequent rules in the same HTTPRoute. This means valid rules with lower precedence (shorter paths, later in the route) will not be created. </p>
<h4 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h4>
<h5 id="modifying-request-headers">Modifying Request Headers<a class="headerlink" href="#modifying-request-headers" title="Permanent link">&para;</a></h5>
<p>AWS ALB only allows <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/header-modification.html">specific</a> request headers to be modified.</p>
<p>** Request header modification must be done using the LoadBalancerConfiguration, using <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-header-modification.html">Listener Attributes</a> **</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancerConfiguration</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">listenerConfigurations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocolPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS:443</span>
<span class="w">      </span><span class="nt">defaultCertificate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cert</span>
<span class="w">      </span><span class="nt">listenerAttributes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">routing.http.response.access_control_allow_origin.header_value</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="nn">---</span>
<span class="c1"># my-alb-gateway.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-alb-gateway</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-alb-gateway-class</span>
<span class="w">  </span><span class="nt">infrastructure</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parametersRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancerConfiguration</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-gw-lbconfig-1</span>
<span class="w">      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws</span>
<span class="w">  </span><span class="nt">listeners</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">      </span><span class="nt">allowedRoutes</span><span class="p">:</span>
<span class="w">        </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Same</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-app-route</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-gateway</span>
<span class="w">      </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echoserver</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</code></pre></div>
<h5 id="http-header-matching">HTTP Header Matching<a class="headerlink" href="#http-header-matching" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-app-route</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-gateway</span>
<span class="w">      </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echoserver</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;oneHeaderSpecial&quot;</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exact</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bar\\,bat&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;multiHeader&quot;</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exact</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1,value2&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;oneHeader&quot;</span>
<span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exact</span>
<span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cat&quot;</span>
</code></pre></div>
<p>In this example will <em>only</em> be forwarded to the echoserver backend when the HTTP Request has these headers:
<code>oneHeaderSpecial=bar,bat</code>
AND
<code>multiHeader=value1</code> OR <code>multiHeader=value2</code>
AND
<code>oneHeader=cat</code></p>
<h5 id="source-ip-condition">Source IP Condition<a class="headerlink" href="#source-ip-condition" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ListenerRuleConfiguration</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-rule-config-source-ip</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source-ip</span>
<span class="w">      </span><span class="nt">sourceIPConfig</span><span class="p">:</span>
<span class="w">        </span><span class="nt">values</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/5</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-app-route</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-ns</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-http-gateway</span>
<span class="w">      </span><span class="nt">sectionName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echoserver</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">extensionRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.k8s.aws</span>
<span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ListenerRuleConfiguration</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-rule-config-source-ip</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExtensionRef</span>
<span class="w">      </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
      
    
    <script src="../../../assets/javascripts/version-select.js"></script>

  </body>
</html>